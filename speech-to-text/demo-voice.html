<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°T - è¯­éŸ³å¯¹è¯ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            min-height: 100vh; 
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        #container { 
            width: 100vw; 
            height: 100vh; 
            position: fixed;
            top: 0;
            left: 0;
        }
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            min-width: 350px;
        }
        .row {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            background: rgba(255, 255, 255, 0.08);
        }
        .btn:hover { transform: scale(1.05); }
        .btn:active { transform: scale(0.98); }
        .btn-mic {
            background: linear-gradient(135deg, #00FFFF, #0099FF);
            color: #000;
            border: none;
            min-width: 120px;
        }
        .btn-mic.recording {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            animation: pulse 1s infinite;
        }
        .btn-tts {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
        }
        .title {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
        }
        .title h1 {
            font-size: 26px;
            font-weight: 700;
            background: linear-gradient(135deg, #00FFFF, #FF69B4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .title p {
            color: #666;
            font-size: 11px;
            margin-top: 5px;
        }
        .chat-box {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            padding: 15px;
            background: rgba(10, 10, 15, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .message {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 8px;
            font-size: 14px;
            animation: fadeIn 0.3s ease;
        }
        .message.user {
            background: rgba(0, 255, 255, 0.1);
            color: #00FFFF;
            text-align: right;
        }
        .message.xiaot {
            background: rgba(255, 105, 180, 0.1);
            color: #FF69B4;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .emotion-row {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .emotion-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }
        .emotion-btn:hover, .emotion-btn.active {
            transform: scale(1.2);
            border-color: currentColor;
            box-shadow: 0 0 15px currentColor;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div class="title">
        <h1>ğŸ¤– å°T</h1>
        <p>è¯­éŸ³å¯¹è¯ç‰ˆ - ç‚¹å‡»éº¦å…‹é£å¼€å§‹å¯¹è¯</p>
    </div>
    
    <!-- èŠå¤©è®°å½• -->
    <div class="chat-box" id="chatBox">
        <div class="message xiaot">ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯å°Tï¼Œç‚¹å‡»ä¸‹æ–¹éº¦å…‹é£æŒ‰é’®å¼€å§‹å¯¹è¯~</div>
    </div>
    
    <div class="controls">
        <!-- æƒ…ç»ªé€‰æ‹© -->
        <div class="emotion-row">
            <button class="emotion-btn active" style="color: #00FFFF; background: rgba(0,255,255,0.1);" onclick="setEmotion('calm')" title="å¹³é™">ğŸ›‹ï¸</button>
            <button class="emotion-btn" style="color: #FFDD00; background: rgba(255,221,0,0.1);" onclick="setEmotion('happy')" title="å¼€å¿ƒ">ğŸ˜Š</button>
            <button class="emotion-btn" style="color: #FF6B00; background: rgba(255,107,0,0.1);" onclick="setEmotion('excited')" title="å…´å¥‹">âœ¨</button>
            <button class="emotion-btn" style="color: #6B5BFF; background: rgba(107,91,255,0.1);" onclick="setEmotion('sad')" title="æ‚²ä¼¤">ğŸ˜¢</button>
            <button class="emotion-btn" style="color: #FF3333; background: rgba(255,51,51,0.1);" onclick="setEmotion('serious')" title="ä¸¥è‚ƒ">ğŸ˜</button>
            <button class="emotion-btn" style="color: #00FF88; background: rgba(0,255,136,0.1);" onclick="setEmotion('thinking')" title="æ€è€ƒ">ğŸ¤”</button>
        </div>
        
        <div class="row">
            <button class="btn btn-mic" id="btn-mic" onclick="toggleRecording()">
                ğŸ¤ ç‚¹å‡»è¯´è¯
            </button>
            <button class="btn btn-tts" onclick="testTTS()">
                ğŸ”Š æµ‹è¯•è¯­éŸ³
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="js/xiaot-core.js"></script>
    
    <script>
        let xiaot = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let currentEmotion = 'calm';
        
        const emotions = ['calm', 'happy', 'excited', 'sad', 'serious', 'thinking'];
        const emotionEmojis = ['ğŸ›‹ï¸', 'ğŸ˜Š', 'âœ¨', 'ğŸ˜¢', 'ğŸ˜', 'ğŸ¤”'];
        
        function init() {
            xiaot = new XiaotInterface({
                container: '#container',
                theme: 'jarvis',
                particles: true,
                autostart: true
            });
            console.log('ğŸš€ å°T Voice initialized!');
        }
        
        function setEmotion(emotion) {
            currentEmotion = emotion;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.emotion-btn').forEach((btn, i) => {
                btn.classList.remove('active');
                if (emotions[i] === emotion) {
                    btn.classList.add('active');
                }
            });
            
            if (xiaot) {
                xiaot.setEmotion(emotion);
            }
        }
        
        async function toggleRecording() {
            const btn = document.getElementById('btn-mic');
            
            if (isRecording) {
                // åœæ­¢å½•éŸ³
                stopRecording();
                btn.textContent = 'ğŸ¤ ç‚¹å‡»è¯´è¯';
                btn.classList.remove('recording');
                isRecording = false;
            } else {
                // å¼€å§‹å½•éŸ³
                await startRecording();
                btn.textContent = 'ğŸ”´ å½•éŸ³ä¸­...';
                btn.classList.add('recording');
                isRecording = true;
            }
        }
        
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    await processVoiceInput(audioBlob);
                    
                    // åœæ­¢æ‰€æœ‰éŸ³è½¨
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                
                // 5ç§’åè‡ªåŠ¨åœæ­¢
                setTimeout(() => {
                    if (isRecording) {
                        stopRecording();
                    }
                }, 5000);
                
            } catch (e) {
                console.error('âŒ Microphone error:', e);
                addMessage('xiaot', 'âŒ æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
        }
        
        async function processVoiceInput(audioBlob) {
            // æ˜¾ç¤ºæ­£åœ¨å¤„ç†
            addMessage('xiaot', 'ğŸ”„ è¯†åˆ«ä¸­...');
            
            // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«ï¼ˆå®é™…ä½¿ç”¨ Whisper APIï¼‰
            // const transcript = await whisper.transcribe(audioBlob);
            
            // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœ
            const randomPhrases = [
                'ä»Šå¤©å¤©æ°”çœŸå¥½ï¼',
                'å¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹æ¯”ç‰¹å¸ä»·æ ¼',
                'æ‰“å¼€å®¢å…çš„ç¯',
                'æ˜å¤©æœ‰ä»€ä¹ˆæ—¥ç¨‹å®‰æ’ï¼Ÿ',
                'æ’­æ”¾ä¸€äº›è½»æ¾çš„éŸ³ä¹',
                'è®¾ç½®ä¸€ä¸ªæ˜æ—©8ç‚¹çš„é—¹é’Ÿ'
            ];
            const transcript = randomPhrases[Math.floor(Math.random() * randomPhrases.length)];
            
            // ç§»é™¤"è¯†åˆ«ä¸­"
            document.querySelector('.chat-box .message:last-child').remove();
            
            // æ˜¾ç¤ºç”¨æˆ·è¯´çš„è¯
            addMessage('user', transcript);
            
            // å°Tæ€è€ƒåå›å¤
            setTimeout(() => {
                const responses = [
                    'æ”¶åˆ°ï¼æˆ‘æ¥å¸®ä½ å¤„ç†~',
                    'å¥½çš„ï¼Œè¿™ä¸ªè¯·æ±‚å¾ˆæœ‰è¶£ï¼',
                    'æ˜ç™½äº†ï¼Œè®©æˆ‘çœ‹çœ‹æ€ä¹ˆåš',
                    'æ²¡é—®é¢˜ï¼Œé©¬ä¸Šå°±å¥½ï¼',
                    'äº†è§£ï¼Œæˆ‘è¿™å°±æ“ä½œ',
                    'å¥½çš„ï¼Œæ­£åœ¨æ‰§è¡Œä¸­...'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addMessage('xiaot', response);
                
                // æ’­æ”¾è¯­éŸ³å›å¤ï¼ˆæ¨¡æ‹Ÿï¼‰
                simulateTTS(response);
            }, 800);
        }
        
        function simulateTTS(text) {
            // æ”¹å˜å°Tä¸ºè¯´è¯çŠ¶æ€
            if (xiaot) {
                xiaot.setEmotion('listening');
                setTimeout(() => {
                    xiaot.setEmotion(currentEmotion);
                }, 2000);
            }
        }
        
        function testTTS() {
            const phrases = [
                'ä½ å¥½ï¼Œæˆ‘æ˜¯å°Tï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼',
                'ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡å“¦ï¼',
                'æ”¶åˆ°ï¼Œé©¬ä¸Šå¸®ä½ å¤„ç†ï¼',
                'æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼'
            ];
            const text = phrases[Math.floor(Math.random() * phrases.length)];
            addMessage('xiaot', `ğŸ”Š [è¯­éŸ³] ${text}`);
            
            simulateTTS(text);
        }
        
        function addMessage(type, text) {
            const chatBox = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        window.onload = init;
    </script>
</body>
</html>
