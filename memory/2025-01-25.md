# 2025-01-25

## Jarvis WebSocket 模式开发

### OpenClaw Gateway 协议发现

**端口**: `ws://127.0.0.1:18789`

**通信协议**:
- 握手: `hello` → `hello.ok`
- 请求/响应: `request` (带 seq id) / `response`
- 事件: `event` 类型，`chat.delta` 用于流式输出
- 需要唯一 `clientName` 避免与其他客户端（如 TUI）冲突

**关键文件**:
- `/opt/homebrew/lib/node_modules/openclaw/dist/gateway/server-http.js` - HTTP 入口
- `/opt/homebrew/lib/node_modules/openclaw/dist/gateway/server-chat.js` - 聊天处理
- `/opt/homebrew/lib/node_modules/openclaw/dist/tui/gateway-chat.js` - TUI 客户端示例

**发现的方法**:
- `chat.send` - 发送消息
- `chat.history` - 获取历史
- `sessions.list` - 列出会话
- `agents.list` - 列出代理

### Jarvis 更新
- 新增 WebSocket 模式，支持连接到 OpenClaw Gateway
- 客户端名称: `jarvis-web`
- 失败时自动降级到本地回复

### 相关文件
- `/Users/moltbot-stardust/.clawdbot/skills/openclaw-skills/jarvis-voice-assistant/index.html`
